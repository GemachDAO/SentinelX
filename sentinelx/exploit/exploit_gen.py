from __future__ import annotations
from pwn import *
import angr
from ..core.task import Task

class AutoPwn(Task):
    async def run(self):
        bin_path = self.params["binary"]
        proj = angr.Project(bin_path, load_options={"auto_load_libs": False})
        sm = proj.factory.simulation_manager()
        sm.explore(find=lambda s: b"Congrats" in s.posix.dumps(1))
        if sm.found:
            exploit_state = sm.found[0]
            flag = exploit_state.posix.dumps(0)
            return {"status": "pwned", "flag": flag.hex()}
        return {"status": "no-bug"}
